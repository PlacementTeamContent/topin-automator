<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Assessment Configuration Template</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
  :root {
    --bg: #f5f3ee;
    --surface: #ffffff;
    --border: #2c2c2c;
    --border-light: #d0ccc4;
    --accent: #1a472a;
    --accent2: #e8421a;
    --text: #1a1a1a;
    --text-muted: #6b6560;
    --label-bg: #2c2c2c;
    --label-fg: #f5f3ee;
    --mono: 'IBM Plex Mono', monospace;
    --sans: 'IBM Plex Sans', sans-serif;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: var(--sans);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 40px 20px 80px;
  }

  .page { max-width: 900px; margin: 0 auto; }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    border: 2px solid var(--border);
    padding: 24px 32px;
    margin-bottom: 32px;
    background: var(--surface);
  }
  .header-title {
    font-family: var(--mono);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
  }

  /* â”€â”€ BLOCK â”€â”€ */
  .block {
    border: 2px solid var(--border);
    background: var(--surface);
    margin-bottom: 28px;
  }
  .block-header {
    background: var(--label-bg);
    color: var(--label-fg);
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    padding: 10px 20px;
  }

  /* â”€â”€ GRID CELLS â”€â”€ */
  .two-col-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
  }
  .two-col-grid > .grid-cell {
    border-right: 1px solid var(--border-light);
    border-bottom: 1px solid var(--border-light);
  }
  .two-col-grid > .grid-cell:nth-child(even) { border-right: none; }

  .field { display: flex; flex-direction: column; height: 100%; }
  .field label {
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    padding: 10px 16px 4px;
    border-bottom: 1px solid var(--border-light);
    background: #fafaf8;
  }
  .field input,
  .field select,
  .field textarea {
    font-family: var(--sans);
    font-size: 14px;
    color: var(--text);
    border: none;
    outline: none;
    padding: 10px 16px;
    background: transparent;
    width: 100%;
    resize: none;
  }
  .field input:focus,
  .field select:focus,
  .field textarea:focus {
    background: #fffef9;
    box-shadow: inset 3px 0 0 var(--accent);
  }
  .field select {
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath d='M1 1l5 5 5-5' stroke='%236b6560' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 14px center;
    padding-right: 36px;
    cursor: pointer;
  }

  /* â”€â”€ TOGGLE (Yes/No) â”€â”€ */
  .toggle {
    display: flex;
    border: 1.5px solid var(--border);
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    flex-shrink: 0;
  }
  .toggle input[type="radio"] { display: none; }
  .toggle label {
    padding: 5px 14px;
    cursor: pointer;
    letter-spacing: 0.06em;
    color: var(--text-muted);
    border-right: 1px solid var(--border);
  }
  .toggle label:last-of-type { border-right: none; }
  .toggle input[type="radio"]:checked + label {
    background: var(--accent);
    color: #fff;
  }

  /* â”€â”€ RADIO GROUP â”€â”€ */
  .radio-opts {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }
  .radio-opt {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 500;
    color: var(--text);
  }
  .radio-opt input[type="radio"] { display: none; }
  .radio-dot {
    width: 14px; height: 14px;
    border: 2px solid var(--border-light);
    border-radius: 50%;
    flex-shrink: 0;
    transition: all 0.15s;
  }
  .radio-opt input[type="radio"]:checked ~ .radio-dot {
    border-color: var(--accent);
    background: var(--accent);
    box-shadow: inset 0 0 0 2px #fff;
  }

  /* â”€â”€ ADVANCED OPTIONS (collapsible) â”€â”€ */
  .adv-block {
    border: 2px solid var(--border);
    background: var(--surface);
    margin-bottom: 28px;
  }
  .adv-toggle-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 20px;
    cursor: pointer;
    user-select: none;
    background: var(--label-bg);
    color: var(--label-fg);
  }
  .adv-toggle-header:hover { background: #3a3a3a; }
  .adv-header-left {
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
  }
  .adv-chevron {
    font-family: var(--mono);
    font-size: 11px;
    color: var(--label-fg);
    transition: transform 0.2s;
    display: inline-block;
  }
  .adv-chevron.open { transform: rotate(180deg); }

  .adv-body { display: none; }
  .adv-body.open { display: block; }

  .adv-row {
    border-bottom: 1px solid var(--border-light);
    padding: 13px 20px;
  }
  .adv-row:last-child { border-bottom: none; }
  .adv-row-top {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 16px;
  }
  .adv-label {
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--text);
  }
  .adv-desc {
    font-size: 11px;
    color: var(--text-muted);
    margin-top: 3px;
    line-height: 1.5;
  }
  .adv-sub-label {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--text-muted);
    padding: 7px 20px;
    background: #f7f5f1;
    border-bottom: 1px solid var(--border-light);
    border-top: 1px solid var(--border-light);
  }
  .btn-inline {
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 5px 12px;
    border: 1.5px solid var(--border);
    background: transparent;
    color: var(--text);
    cursor: pointer;
    margin-top: 8px;
  }
  .btn-inline:hover { background: var(--border-light); }

  /* â”€â”€ SECTIONS AREA â”€â”€ */
  .sections-block {
    border: 2px solid var(--border);
    background: var(--surface);
    margin-bottom: 28px;
  }
  .sections-block-header {
    background: var(--label-bg);
    color: var(--label-fg);
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .add-section-btn {
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 4px 12px;
    border: 1.5px solid rgba(255,255,255,0.4);
    background: transparent;
    color: #fff;
    cursor: pointer;
    transition: background 0.15s;
  }
  .add-section-btn:hover { background: rgba(255,255,255,0.15); }

  /* Section tabs */
  .section-tabs {
    display: flex;
    border-bottom: 1px solid var(--border-light);
    background: #fafaf8;
    flex-wrap: wrap;
  }
  .section-tab {
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 10px 14px;
    cursor: pointer;
    border-right: 1px solid var(--border-light);
    color: var(--text-muted);
    display: flex;
    align-items: center;
    gap: 7px;
    transition: background 0.15s;
    position: relative;
    user-select: none;
  }
  .section-tab .drag-handle {
    color: var(--border-light);
    font-size: 12px;
    cursor: grab;
    line-height: 1;
    transition: color 0.15s;
    flex-shrink: 0;
  }
  .section-tab:hover .drag-handle { color: var(--text-muted); }
  .section-tab.drag-over {
    background: #edf7f1;
    border-left: 2px solid var(--accent);
  }
  .section-tab.dragging { opacity: 0.4; }
  .section-tab:hover { background: #f0ede7; }
  .section-tab.active {
    background: var(--surface);
    color: var(--text);
    border-bottom: 2px solid var(--accent);
    margin-bottom: -1px;
  }
  .section-tab .tab-type-pill {
    font-size: 9px;
    padding: 1px 6px;
    border-radius: 2px;
    font-weight: 700;
    letter-spacing: 0.04em;
  }
  .pill-coding     { background: #e6fcf5; color: #087f5b; }
  .pill-mcq        { background: #e8edff; color: #3b5bdb; }
  .pill-subjective { background: #fff3e0; color: #e65100; }
  .pill-sql        { background: #fff0f6; color: #c2255c; }
  .pill-webcoding  { background: #e8f4fd; color: #1864ab; }
  .pill-idecoding  { background: #f3f0ff; color: #6741d9; }
  .section-tab .remove-tab {
    font-size: 13px;
    color: var(--text-muted);
    line-height: 1;
    padding: 0 2px;
  }
  .section-tab .remove-tab:hover { color: var(--accent2); }

  /* Section panel */
  .section-panel { display: none; }
  .section-panel.active { display: block; }

  .section-panel-header {
    background: var(--accent);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px 20px;
  }
  .section-panel-header span {
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
  }
  .type-pill {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 700;
    padding: 2px 10px;
    letter-spacing: 0.06em;
  }
  .type-pill-coding     { background: rgba(255,255,255,0.15); color: #fff; }
  .type-pill-mcq        { background: rgba(255,255,255,0.15); color: #fff; }
  .type-pill-subjective { background: rgba(255,255,255,0.15); color: #fff; }

  /* â”€â”€ TAG COMBINATIONS â”€â”€ */
  .tag-combo-list { padding: 8px 16px 4px; }
  .tag-combo-row {
    display: flex;
    align-items: flex-start;
    gap: 8px;
    margin-bottom: 8px;
    background: #fafaf8;
    border: 1px solid var(--border-light);
    padding: 8px 10px;
    border-radius: 3px;
  }
  .tag-combo-index {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 700;
    color: var(--text-muted);
    padding-top: 6px;
    min-width: 22px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }
  .tag-combo-input-wrap {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    align-items: center;
    min-height: 34px;
    cursor: text;
    padding: 4px 6px;
    border: 1px solid var(--border-light);
    background: #fff;
  }
  .tag-combo-input-wrap:focus-within {
    background: #fffef9;
    box-shadow: inset 2px 0 0 var(--accent);
  }
  .tag-combo-text {
    border: none !important;
    outline: none !important;
    padding: 2px 4px !important;
    font-family: var(--sans);
    font-size: 12px;
    background: transparent !important;
    box-shadow: none !important;
    min-width: 120px;
    flex: 1;
  }
  .tag-combo-delete {
    font-family: var(--mono);
    font-size: 12px;
    color: var(--text-muted);
    cursor: pointer;
    padding: 6px 4px;
    line-height: 1;
    flex-shrink: 0;
    transition: color 0.15s;
  }
  .tag-combo-delete:hover { color: var(--accent2); }
  .add-combo-btn {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 5px 12px;
    border: 1.5px dashed var(--border-light);
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    margin: 0 16px 12px;
    display: block;
    width: calc(100% - 32px);
    transition: all 0.15s;
  }
  .add-combo-btn:hover { border-color: var(--accent); color: var(--accent); background: #edf7f1; }

  /* Fields inside sections */
  .three-col-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
  }
  .three-col-grid > .grid-cell {
    border-right: 1px solid var(--border-light);
    border-bottom: 1px solid var(--border-light);
  }
  .three-col-grid > .grid-cell:nth-child(3n) { border-right: none; }
  .three-col-grid > .grid-cell[style*="span 3"] { border-right: none; }

  .two-col-inner {
    display: grid;
    grid-template-columns: 1fr 1fr;
    border-top: 1px solid var(--border-light);
  }
  .two-col-inner > .grid-cell {
    border-right: 1px solid var(--border-light);
    border-bottom: 1px solid var(--border-light);
  }
  .two-col-inner > .grid-cell:nth-child(even) { border-right: none; }

  /* Languages block */
  .lang-block {
    border-top: 1px solid var(--border-light);
    padding: 14px 16px;
  }
  .lang-block-label {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-muted);
    margin-bottom: 10px;
  }
  .lang-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
  }
  .lang-tag {
    display: flex;
    align-items: center;
    gap: 6px;
    background: #edf7f1;
    border: 1.5px solid #1a6b3a;
    color: #1a472a;
    font-family: var(--mono);
    font-size: 11px;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 3px;
  }
  .lang-tag.default-lang { background: var(--accent); color: #fff; border-color: var(--accent); }
  .lang-tag .remove-lang {
    cursor: pointer;
    font-size: 13px;
    line-height: 1;
    opacity: 0.6;
  }
  .lang-tag .remove-lang:hover { opacity: 1; }
  .lang-default-label {
    font-family: var(--mono);
    font-size: 9px;
    letter-spacing: 0.06em;
    opacity: 0.8;
  }
  .lang-set-default {
    cursor: pointer;
    font-size: 12px;
    opacity: 0.4;
    line-height: 1;
    transition: opacity 0.15s, color 0.15s;
    color: #8a6a00;
  }
  .lang-set-default:hover { opacity: 1; }
  .lang-add-wrap {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-top: 8px;
  }
  .lang-add-select {
    font-family: var(--mono);
    font-size: 11px;
    border: 1.5px solid var(--border-light);
    padding: 5px 28px 5px 10px;
    background: #fff;
    color: var(--text-muted);
    outline: none;
    cursor: pointer;
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%236b6560' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
  }
  .lang-add-btn {
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    padding: 5px 12px;
    border: 1.5px solid var(--border);
    background: transparent;
    color: var(--text);
    cursor: pointer;
    letter-spacing: 0.04em;
  }
  .lang-add-btn:hover { background: var(--border-light); }

  /* Question table */
  .table-wrap { overflow-x: auto; border-top: 1px solid var(--border-light); }
  .sep-label {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-muted);
    padding: 8px 16px;
    background: #f7f5f1;
    border-bottom: 1px solid var(--border-light);
  }
  table { width: 100%; border-collapse: collapse; font-size: 13px; }
  thead tr { background: #f0ede7; }
  thead th {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--text-muted);
    padding: 10px 14px;
    text-align: left;
    border-right: 1px solid var(--border-light);
    border-bottom: 1px solid var(--border-light);
  }
  thead th:last-child { border-right: none; }
  tbody tr { border-bottom: 1px solid var(--border-light); }
  tbody tr:last-child { border-bottom: none; }
  tbody td { padding: 0; border-right: 1px solid var(--border-light); vertical-align: middle; }
  tbody td:last-child { border-right: none; }
  .diff-label { font-family: var(--mono); font-size: 11px; font-weight: 600; padding: 10px 14px; letter-spacing: 0.04em; }
  .diff-easy   { color: #1a6b3a; background: #edf7f1; }
  .diff-medium { color: #8a5c00; background: #fdf7ed; }
  .diff-hard   { color: #9b1515; background: #fdf0f0; }
  tbody td input, tbody td select {
    font-family: var(--sans);
    font-size: 13px;
    border: none;
    outline: none;
    padding: 10px 14px;
    width: 100%;
    background: transparent;
    appearance: none;
  }
  tbody td input:focus, tbody td select:focus {
    background: #fffef9;
    box-shadow: inset 2px 0 0 var(--accent);
  }

  /* â”€â”€ TAG CHIP INPUT â”€â”€ */
  .tag-input-wrap {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: flex-start;
    padding: 8px 12px;
    min-height: 42px;
    cursor: text;
  }
  .tag-input-wrap:focus-within {
    background: #fffef9;
    box-shadow: inset 3px 0 0 var(--accent);
  }
  .tag-chips {
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    align-items: center;
  }
  .tag-chip {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    background: #edf7f1;
    border: 1.5px solid #1a6b3a;
    color: #1a472a;
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 3px;
    letter-spacing: 0.04em;
  }
  .tag-chip-remove {
    cursor: pointer;
    font-size: 12px;
    line-height: 1;
    opacity: 0.6;
  }
  .tag-chip-remove:hover { opacity: 1; color: var(--accent2); }
  .tag-text-input {
    border: none !important;
    outline: none !important;
    padding: 2px 4px !important;
    font-family: var(--sans);
    font-size: 13px;
    background: transparent !important;
    box-shadow: none !important;
    min-width: 160px;
    flex: 1;
  }

  .two-col-grid > .grid-cell[style*="span 2"] {
    border-right: none;
  }

  /* sections-block reuses adv-block but keeps section-tabs flush */
  .sections-block .adv-body.open {
    display: block;
    padding: 0;
  }
  .sections-block .section-tabs {
    border-top: none;
  }
  .section-meta {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    border-bottom: 1px solid var(--border-light);
  }
  .section-meta > .grid-cell {
    border-right: 1px solid var(--border-light);
    border-bottom: none;
  }
  .section-meta > .grid-cell:last-child { border-right: none; }

  /* â”€â”€ QUESTION ROWS TABLE â”€â”€ */
  .qrows-table-header {
    background: var(--label-bg);
    color: var(--label-fg);
    font-family: var(--mono);
    font-size: 10px;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    padding: 8px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .add-qrow-btn {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    padding: 3px 10px;
    border: 1.5px solid rgba(255,255,255,0.4);
    background: transparent;
    color: #fff;
    cursor: pointer;
    transition: background 0.15s;
  }
  .add-qrow-btn:hover { background: rgba(255,255,255,0.15); }

  .qrows-table { width: 100%; border-collapse: collapse; font-size: 13px; }
  .qrows-table thead tr { background: #f0ede7; }
  .qrows-table thead th {
    font-family: var(--mono);
    font-size: 9px;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    color: var(--text-muted);
    padding: 9px 10px;
    text-align: left;
    border-right: 1px solid var(--border-light);
    border-bottom: 2px solid var(--border-light);
    white-space: nowrap;
  }
  .qrows-table thead th:last-child { border-right: none; }
  .qrows-table tbody tr { border-bottom: 1px solid var(--border-light); transition: background 0.1s; }
  .qrows-table tbody tr:last-child { border-bottom: none; }
  .qrows-table tbody tr:hover { background: #fafaf8; }
  .qrows-table tbody td { padding: 0; border-right: 1px solid var(--border-light); vertical-align: middle; }
  .qrows-table tbody td:last-child { border-right: none; }
  .qrows-table tbody td input,
  .qrows-table tbody td select {
    font-family: var(--sans);
    font-size: 13px;
    border: none;
    outline: none;
    padding: 9px 10px;
    width: 100%;
    background: transparent;
    appearance: none;
    color: var(--text);
  }
  .qrows-table tbody td input[type=number] { text-align: center; }
  .qrows-table tbody td select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%236b6560' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 8px center;
    padding-right: 26px;
    cursor: pointer;
  }
  .qrows-table tbody td input:focus,
  .qrows-table tbody td select:focus { background-color: #fffef9; box-shadow: inset 2px 0 0 var(--accent); }
  .qrow-delete-cell { width: 36px; text-align: center; }
  .qrow-delete-btn {
    background: none; border: none; cursor: pointer;
    color: var(--text-muted); font-size: 14px; padding: 6px; line-height: 1; transition: color 0.15s;
  }
  .qrow-delete-btn:hover { color: var(--accent2); }

  /* Tag chips inside table cell */
  .qrow-tag-cell { min-width: 160px; }
  .qrow-tag-wrap {
    display: flex; flex-wrap: wrap; gap: 4px; align-items: center;
    padding: 5px 8px; min-height: 36px; cursor: text;
  }
  .qrow-tag-wrap:focus-within { background: #fffef9; box-shadow: inset 2px 0 0 var(--accent); }
  .qrow-tag-chip {
    display: inline-flex; align-items: center; gap: 3px;
    background: #edf7f1; border: 1.5px solid #1a6b3a; color: #1a472a;
    font-family: var(--mono); font-size: 9px; font-weight: 600;
    padding: 2px 6px; border-radius: 2px; white-space: nowrap;
  }
  .qrow-chip-remove { cursor: pointer; opacity: 0.6; font-size: 11px; line-height: 1; }
  .qrow-chip-remove:hover { opacity: 1; color: var(--accent2); }
  .qrow-tag-input {
    border: none !important; outline: none !important;
    background: transparent !important; box-shadow: none !important;
    font-family: var(--sans); font-size: 12px; min-width: 80px; flex: 1; padding: 2px !important;
  }

  .qrows-table tbody tr.qrow-group-start td {
    border-top: 2px solid var(--border-light);
  }
  .qrows-table tbody tr:first-child.qrow-group-start td {
    border-top: none;
  }

  .actions {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
    margin-top: 4px;
  }
  button.btn {
    font-family: var(--mono);
    font-size: 11px;
    font-weight: 600;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 12px 28px;
    border: 2px solid var(--border);
    cursor: pointer;
    transition: all 0.15s;
  }
  .btn-primary   { background: var(--accent); color: #fff; border-color: var(--accent); }
  .btn-primary:hover { background: #143d22; }
  .btn-secondary { background: transparent; color: var(--text); }
  .btn-secondary:hover { background: var(--border-light); }
  .btn-danger    { background: var(--accent2); color: #fff; border-color: var(--accent2); }
  .btn-danger:hover { background: #c73512; }
  .btn-publish   { background: #6741d9; color: #fff; border-color: #6741d9; }
  .btn-publish:hover { background: #5433b0; }
</style>
</head>
<body>
<div class="page">

  <!-- HEADER -->
  <header>
    <div style="display:flex;flex-direction:column;gap:6px;">
      <div style="font-family:var(--mono);font-size:13px;font-weight:600;letter-spacing:0.08em;color:var(--text-muted);">topin.tech</div>
      <h1 style="font-family:var(--mono);font-size:26px;font-weight:600;color:var(--text);letter-spacing:-0.02em;">Configuration Template</h1>
    </div>
  </header>

  <!-- â”€â”€ GENERAL INFORMATION â”€â”€ -->
  <div class="adv-block">
    <div class="adv-toggle-header" onclick="toggleBlock('genBody','genChevron')">
      <span class="adv-header-left">General Information</span>
      <span class="adv-chevron open" id="genChevron">â–¼</span>
    </div>
    <div class="adv-body open" id="genBody">
      <div class="two-col-grid">
        <div class="grid-cell">
          <div class="field">
            <label>Name of Assessment</label>
            <input type="text" placeholder="e.g. Backend Engineer Round 1">
          </div>
        </div>
        <div class="grid-cell">
          <div class="field">
            <label>Organization Name</label>
            <input type="text" value="NxtWave">
          </div>
        </div>
        <div class="grid-cell">
          <div class="field">
            <label>Start Date &amp; Time</label>
            <input type="datetime-local">
          </div>
        </div>
        <div class="grid-cell">
          <div class="field">
            <label>End Date &amp; Time</label>
            <input type="datetime-local">
          </div>
        </div>
        <div class="grid-cell" style="grid-column: span 2;">
          <div class="field">
            <label>Organization Logo URL</label>
            <input type="url" value="https://globalprimenews.com/wp-content/uploads/2023/12/IMG_20231202_031333.jpg">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- â”€â”€ SECTION CONFIGURATION â”€â”€ -->
  <div class="adv-block sections-block">
    <div class="adv-toggle-header sections-block-header" onclick="toggleBlock('sectionsBody','sectionsChevron')">
      <span class="adv-header-left">Section Configuration</span>
      <div style="display:flex;align-items:center;gap:12px;">
        <button class="add-section-btn" onclick="event.stopPropagation();addSection()">ï¼‹ Add Section</button>
        <span class="adv-chevron open" id="sectionsChevron">â–¼</span>
      </div>
    </div>
    <div class="adv-body open" id="sectionsBody">
      <!-- Tabs -->
      <div class="section-tabs" id="sectionTabs"></div>
      <!-- Panels -->
      <div id="sectionPanels"></div>
    </div>
  </div>

  <!-- â”€â”€ ADVANCED OPTIONS (collapsible) â”€â”€ -->
  <div class="adv-block">
    <div class="adv-toggle-header" onclick="toggleAdv()">
      <span class="adv-header-left">Advanced Options</span>
      <span class="adv-chevron" id="advChevron">â–¼</span>
    </div>
    <div class="adv-body" id="advBody">

      <div class="adv-row">
        <div class="adv-row-top">
          <div><div class="adv-label">Tab Switch Allowed</div><div class="adv-desc">Allow candidates to switch browser tabs during the assessment.</div></div>
          <div class="toggle"><input type="radio" name="tab_switch" id="ts_y"><label for="ts_y">Yes</label><input type="radio" name="tab_switch" id="ts_n" checked><label for="ts_n">No</label></div>
        </div>
      </div>

      <div class="adv-row">
        <div class="adv-row-top">
          <div><div class="adv-label">Proctoring</div><div class="adv-desc">Enable proctoring to monitor candidates during the assessment.</div></div>
          <div class="toggle"><input type="radio" name="proctoring" id="proc_y" checked><label for="proc_y">On</label><input type="radio" name="proctoring" id="proc_n"><label for="proc_n">Off</label></div>
        </div>
      </div>

    </div><!-- /adv-body -->
  </div><!-- /adv-block -->


  <!-- ACTIONS -->
  <div class="actions">
    <button class="btn btn-secondary" onclick="clearAll()">Clear All</button>
    <button class="btn btn-primary" onclick="downloadConfiguration()">&#8659; Download</button>
    <button class="btn btn-primary" onclick="saveConfiguration()">Save Configuration</button>
  </div>

  <!-- PUBLISH RESULT POPUP -->
  <div id="publishResult" style="display:none;margin-top:16px;padding:16px 20px;border:2px solid #6741d9;background:#f8f5ff;font-family:var(--mono);font-size:12px;">
    <div style="display:flex;align-items:center;gap:12px;flex-wrap:wrap;">
      <span id="publishStatus" style="color:#6741d9;font-weight:600;letter-spacing:.06em;text-transform:uppercase;"></span>
      <a id="publishUrl" href="" target="_blank" style="display:none;color:#1a472a;font-weight:600;word-break:break-all;text-decoration:underline;"></a>
      <button id="copyUrlBtn" onclick="copyPublishUrl()" style="display:none;font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;padding:6px 14px;border:2px solid #6741d9;background:transparent;color:#6741d9;cursor:pointer;">Copy URL</button>
    </div>
  </div>

</div><!-- /page -->

<!-- â”€â”€ NETLIFY TOKEN MODAL â”€â”€ -->
<div id="netlifyTokenModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000;align-items:center;justify-content:center;">
  <div style="background:#fff;border:2px solid var(--border);padding:0;width:480px;max-width:95%;">
    <div style="background:var(--label-bg);color:var(--label-fg);font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;padding:12px 20px;">Netlify Personal Access Token</div>
    <div style="padding:20px;">
      <p style="font-size:13px;color:var(--text-muted);margin-bottom:16px;line-height:1.5;">Required once to publish directly to Netlify. Saved locally in your browser.<br>Get yours at: <a href="https://app.netlify.com/user/applications#personal-access-tokens" target="_blank" style="color:#6741d9;">app.netlify.com â†’ User settings â†’ Personal access tokens</a></p>
      <input id="netlifyTokenInput" type="password" placeholder="Paste your Netlify token here..." style="width:100%;font-family:var(--mono);font-size:12px;padding:10px 12px;border:2px solid var(--border-light);outline:none;margin-bottom:16px;" onkeydown="if(event.key==='Enter')saveNetlifyToken()">
      <div style="display:flex;gap:10px;justify-content:flex-end;">
        <button onclick="document.getElementById('netlifyTokenModal').style.display='none'" style="font-family:var(--mono);font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;padding:10px 20px;border:2px solid var(--border);background:transparent;cursor:pointer;">Cancel</button>
        <button onclick="saveNetlifyToken()" style="font-family:var(--mono);font-size:11px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;padding:10px 20px;border:2px solid #6741d9;background:#6741d9;color:#fff;cursor:pointer;">Save & Publish</button>
      </div>
    </div>
  </div>
</div>

<!-- â”€â”€ ADD SECTION MODAL â”€â”€ -->
<div id="addModal" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000;display:none;align-items:center;justify-content:center;">
  <div style="background:#fff;border:2px solid var(--border);padding:0;width:420px;max-width:95%;">
    <div style="background:var(--label-bg);color:var(--label-fg);font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;padding:12px 20px;">Choose Section Type</div>
    <div style="padding:16px 20px 8px;display:grid;grid-template-columns:repeat(3,1fr);gap:10px;">
      <div class="type-choice" id="choice-Coding" onclick="chooseType('Coding')"
        style="border:2px solid var(--border-light);padding:16px 8px;text-align:center;cursor:pointer;transition:all .15s;">
        <div style="font-size:22px;margin-bottom:6px;">ğŸ’»</div>
        <div style="font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.04em;text-transform:uppercase;">Coding</div>
      </div>
      <div class="type-choice" id="choice-MCQ" onclick="chooseType('MCQ')"
        style="border:2px solid var(--border-light);padding:16px 8px;text-align:center;cursor:pointer;transition:all .15s;">
        <div style="font-size:22px;margin-bottom:6px;">â˜°</div>
        <div style="font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.04em;text-transform:uppercase;">MCQ</div>
      </div>
      <div class="type-choice" id="choice-SQL" onclick="chooseType('SQL')"
        style="border:2px solid var(--border-light);padding:16px 8px;text-align:center;cursor:pointer;transition:all .15s;">
        <div style="font-size:22px;margin-bottom:6px;">ğŸ—„ï¸</div>
        <div style="font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.04em;text-transform:uppercase;">SQL</div>
      </div>
      <div class="type-choice" id="choice-WebCoding" onclick="chooseType('WebCoding')"
        style="border:2px solid var(--border-light);padding:16px 8px;text-align:center;cursor:pointer;transition:all .15s;">
        <div style="font-size:22px;margin-bottom:6px;">ğŸŒ</div>
        <div style="font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.04em;text-transform:uppercase;">Web Coding</div>
      </div>
      <div class="type-choice" id="choice-IDECoding" onclick="chooseType('IDECoding')"
        style="border:2px solid var(--border-light);padding:16px 8px;text-align:center;cursor:pointer;transition:all .15s;">
        <div style="font-size:22px;margin-bottom:6px;">âš™ï¸</div>
        <div style="font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.04em;text-transform:uppercase;">IDE Coding</div>
      </div>
    </div>
    <div style="display:flex;gap:10px;padding:8px 20px 16px;">
      <input type="text" id="newSectionName" placeholder="Section name (optional)"
        style="flex:1;font-family:var(--sans);font-size:13px;border:1.5px solid var(--border-light);padding:8px 12px;outline:none;">
    </div>
    <div style="padding:0 20px 20px;display:flex;gap:10px;justify-content:flex-end;">
      <button onclick="closeModal()" style="font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;padding:8px 18px;border:1.5px solid var(--border);background:transparent;cursor:pointer;">Cancel</button>
      <button onclick="confirmAddSection()" style="font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:.08em;text-transform:uppercase;padding:8px 18px;background:var(--accent);color:#fff;border:none;cursor:pointer;">Add Section</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let sections = [];    // [{id, name, type, data:{...}}]
let activeTab = null;
let pendingType = null;
let sectionCounter = 0;

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded', () => {
  // no default sections â€” user adds via "+ Add Section"
});

// â”€â”€â”€ COLLAPSIBLE BLOCKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleAdv() { toggleBlock('advBody', 'advChevron'); }
function toggleBlock(bodyId, chevId) {
  document.getElementById(bodyId).classList.toggle('open');
  document.getElementById(chevId).classList.toggle('open');
}

// â”€â”€â”€ SECTION MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addSection() {
  pendingType = null;
  document.getElementById('newSectionName').value = '';
  document.querySelectorAll('.type-choice').forEach(c => {
    c.style.borderColor = 'var(--border-light)';
    c.style.background = '';
  });
  document.getElementById('addModal').style.display = 'flex';
}

function chooseType(type) {
  pendingType = type;
  document.querySelectorAll('.type-choice').forEach(c => {
    c.style.borderColor = 'var(--border-light)';
    c.style.background = '';
    c.style.color = '';
  });
  const el = document.getElementById('choice-' + type);
  el.style.borderColor = 'var(--accent)';
  el.style.background = '#edf7f1';
}

function closeModal() {
  document.getElementById('addModal').style.display = 'none';
}

function confirmAddSection() {
  if (!pendingType) { alert('Please choose a section type.'); return; }
  const defaultNames = {
    Coding: 'Coding Section', MCQ: 'Technical MCQs',
    SQL: 'SQL Coding', WebCoding: 'Web Coding', IDECoding: 'IDE Coding'
  };
  const name = document.getElementById('newSectionName').value.trim() || defaultNames[pendingType];
  closeModal();
  createSection(pendingType, name);
}

function createSection(type, name) {
  const id = ++sectionCounter;
  const section = { id, name, type, langs: type === 'Coding' ? ['Python','C++','Java'] : [] };
  sections.push(section);
  // init one blank question row
  if (!questionRows[id]) questionRows[id] = [newQRow()];
  renderTabs();
  renderPanels();
  setActiveTab(id);
}

function removeSection(id) {
  sections = sections.filter(s => s.id !== id);
  if (activeTab === id) activeTab = sections.length > 0 ? sections[sections.length - 1].id : null;
  renderTabs();
  renderPanels();
  if (activeTab) setActiveTab(activeTab);
}

function setActiveTab(id) {
  activeTab = id;
  document.querySelectorAll('.section-tab').forEach(t => t.classList.toggle('active', +t.dataset.id === id));
  document.querySelectorAll('.section-panel').forEach(p => p.classList.toggle('active', +p.dataset.id === id));
}

// â”€â”€â”€ RENDER TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTabs() {
  const pillClass = {
    Coding: 'pill-coding', MCQ: 'pill-mcq',
    SQL: 'pill-sql', WebCoding: 'pill-webcoding', IDECoding: 'pill-idecoding'
  };
  const pillLabel = {
    Coding: 'Coding', MCQ: 'MCQ',
    SQL: 'SQL', WebCoding: 'Web', IDECoding: 'IDE'
  };
  document.getElementById('sectionTabs').innerHTML = sections.map(s => `
    <div class="section-tab ${activeTab===s.id?'active':''}" data-id="${s.id}"
      draggable="true"
      ondragstart="dragStart(event,${s.id})"
      ondragover="dragOver(event)"
      ondragleave="dragLeave(event)"
      ondrop="dragDrop(event,${s.id})"
      ondragend="dragEnd(event)"
      onclick="setActiveTab(${s.id})">
      <span class="drag-handle" title="Drag to reorder">â ¿</span>
      <span>${s.name}</span>
      <span class="tab-type-pill ${pillClass[s.type]||'pill-mcq'}">${pillLabel[s.type]||s.type}</span>
      <span class="remove-tab" onclick="event.stopPropagation();removeSection(${s.id})">âœ•</span>
    </div>`).join('');
}

// â”€â”€â”€ DRAG REORDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let dragSrcId = null;

function dragStart(e, id) {
  dragSrcId = id;
  e.currentTarget.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'move';
}
function dragOver(e) {
  e.preventDefault();
  e.dataTransfer.dropEffect = 'move';
  e.currentTarget.classList.add('drag-over');
}
function dragLeave(e) {
  e.currentTarget.classList.remove('drag-over');
}
function dragDrop(e, targetId) {
  e.preventDefault();
  e.currentTarget.classList.remove('drag-over');
  if (dragSrcId === targetId) return;
  const srcIdx = sections.findIndex(s => s.id === dragSrcId);
  const tgtIdx = sections.findIndex(s => s.id === targetId);
  const [moved] = sections.splice(srcIdx, 1);
  sections.splice(tgtIdx, 0, moved);
  renderTabs();
  renderPanels();
  setActiveTab(dragSrcId);
}
function dragEnd(e) {
  e.currentTarget.classList.remove('dragging');
  document.querySelectorAll('.section-tab').forEach(t => t.classList.remove('drag-over'));
}

function renderPanels() {
  const panelFn = {
    Coding: codingPanel, MCQ: mcqPanel,
    SQL: sqlPanel, WebCoding: webCodingPanel, IDECoding: ideCodingPanel
  };
  document.getElementById('sectionPanels').innerHTML = sections.map(s =>
    (panelFn[s.type] || mcqPanel)(s)
  ).join('');
  restoreQRows();
}

// â”€â”€â”€ SHARED SECTION HEADER (meta fields) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function metaFields(s) {
  return `
  <div class="section-meta" style="grid-template-columns:1fr 1fr;">
    <div class="grid-cell">
      <div class="field">
        <label>Name of Section</label>
        <input type="text" value="${s.name}" oninput="updateSectionName(${s.id},this.value)" placeholder="e.g. ${s.name}">
      </div>
    </div>
    <div class="grid-cell">
      <div class="field">
        <label>Time Limit (Mins)</label>
        <input type="number" min="1" placeholder="e.g. 30" id="s${s.id}_time">
      </div>
    </div>
  </div>`;
}

// â”€â”€â”€ QUESTION ROWS TABLE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function qRowsTable(s) {
  const headerBg = {
    Coding: '#087f5b', MCQ: '#3b5bdb',
    SQL: '#c2255c', WebCoding: '#1864ab', IDECoding: '#6741d9'
  }[s.type] || '#2c2c2c';
  return `
  <div class="qrows-table-header" style="background:${headerBg};">
    <span>Question Combinations</span>
    <button class="add-qrow-btn" onclick="addQRow(${s.id})">ï¼‹ Add Row</button>
  </div>
  <div style="overflow-x:auto;">
    <table class="qrows-table">
      <thead>
        <tr>
          <th>Question Library</th>
          <th>Topic</th>
          <th>Sub Topic</th>
          <th>Difficulty Level</th>
          <th>Exclusive Tags</th>
          <th style="text-align:center;">No. of Questions</th>
          <th style="text-align:center;">Marks / Question</th>
          <th class="qrow-delete-cell"></th>
        </tr>
      </thead>
      <tbody id="qrows_${s.id}"></tbody>
    </table>
  </div>`;
}

// â”€â”€â”€ CODING PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function codingPanel(s) {
  const optionalLangs = ['JavaScript', 'C', 'C#'];
  const available = optionalLangs.filter(l => !s.langs.includes(l));
  return `
  <div class="section-panel ${activeTab===s.id?'active':''}" data-id="${s.id}">
    <div class="section-panel-header" style="background:#087f5b;">
      <span>${s.name}</span>
      <span class="type-pill type-pill-coding">Coding</span>
    </div>
    ${metaFields(s)}
    ${qRowsTable(s)}
    <div class="lang-block">
      <div class="lang-block-label">Default Programming Language &amp; Allowed Languages</div>
      <div class="lang-tags" id="langTags_${s.id}">
        ${s.langs.map((l,i) => `
          <div class="lang-tag ${i===0?'default-lang':''}">
            ${i===0
              ? '<span class="lang-default-label">DEFAULT</span> '
              : `<span class="lang-set-default" title="Set as default" onclick="setDefaultLang(${s.id},'${l}')">â˜…</span> `
            }${l}
            ${s.langs.length > 1 ? `<span class="remove-lang" onclick="removeLang(${s.id},'${l}')">âœ•</span>` : ''}
          </div>`).join('')}
      </div>
      ${available.length > 0 ? `
      <div class="lang-add-wrap">
        <select class="lang-add-select" id="langAdd_${s.id}">
          <option value="">ï¼‹ Add languageâ€¦</option>
          ${available.map(l => `<option value="${l}">${l}</option>`).join('')}
        </select>
        <button class="lang-add-btn" onclick="addLang(${s.id})">Add</button>
      </div>` : ''}
    </div>
  </div>`;
}

// â”€â”€â”€ MCQ PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mcqPanel(s) {
  return `
  <div class="section-panel ${activeTab===s.id?'active':''}" data-id="${s.id}">
    <div class="section-panel-header" style="background:#3b5bdb;">
      <span>${s.name}</span>
      <span class="type-pill type-pill-mcq">MCQ</span>
    </div>
    ${metaFields(s)}
    ${qRowsTable(s)}
  </div>`;
}

// â”€â”€â”€ SQL PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sqlPanel(s) {
  return `
  <div class="section-panel ${activeTab===s.id?'active':''}" data-id="${s.id}">
    <div class="section-panel-header" style="background:#c2255c;">
      <span>${s.name}</span>
      <span class="type-pill" style="background:rgba(255,255,255,0.15);color:#fff;">SQL</span>
    </div>
    ${metaFields(s)}
    ${qRowsTable(s)}
  </div>`;
}

// â”€â”€â”€ WEB CODING PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function webCodingPanel(s) {
  return `
  <div class="section-panel ${activeTab===s.id?'active':''}" data-id="${s.id}">
    <div class="section-panel-header" style="background:#1864ab;">
      <span>${s.name}</span>
      <span class="type-pill" style="background:rgba(255,255,255,0.15);color:#fff;">Web Coding</span>
    </div>
    ${metaFields(s)}
    ${qRowsTable(s)}
  </div>`;
}

// â”€â”€â”€ IDE CODING PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ideCodingPanel(s) {
  return `
  <div class="section-panel ${activeTab===s.id?'active':''}" data-id="${s.id}">
    <div class="section-panel-header" style="background:#6741d9;">
      <span>${s.name}</span>
      <span class="type-pill" style="background:rgba(255,255,255,0.15);color:#fff;">IDE Coding</span>
    </div>
    ${metaFields(s)}
    ${qRowsTable(s)}
  </div>`;
}

// â”€â”€â”€ QUESTION ROWS STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Each "group" = one logical question combination with 3 difficulty sub-rows.
// questionRows[sectionId] = [ { id, lib, topic, subtopic, tags,
//   diffs: { Easy:{numq,outof}, Medium:{numq,outof}, Hard:{numq,outof} } }, ... ]
const questionRows = {};
let qRowCounter = 0;

const DIFFS = ['Easy', 'Medium', 'Hard'];
const DIFF_STYLE = {
  Easy:   { bg: '#edf7f1', color: '#1a6b3a', border: '#a3d9b8' },
  Medium: { bg: '#fdf7ed', color: '#8a5c00', border: '#f0cc80' },
  Hard:   { bg: '#fdf0f0', color: '#9b1515', border: '#f0aaaa' },
};

function newQRow() {
  return {
    id: ++qRowCounter,
    lib: '', topic: '', subtopic: '', tags: [],
    diffs: {
      Easy:   { numq: 1, marks: 1 },
      Medium: { numq: 1, marks: 1 },
      Hard:   { numq: 1, marks: 1 },
    }
  };
}

function addQRow(sectionId) {
  if (!questionRows[sectionId]) questionRows[sectionId] = [];
  questionRows[sectionId].push(newQRow());
  renderQRows(sectionId);
}

function deleteQRow(sectionId, rowId) {
  const rows = questionRows[sectionId];
  if (rows.length <= 1) { alert('At least one question row is required.'); return; }
  questionRows[sectionId] = rows.filter(r => r.id !== rowId);
  renderQRows(sectionId);
}

function saveQRowField(sectionId, rowId, field, value) {
  const row = (questionRows[sectionId]||[]).find(r => r.id === rowId);
  if (row) row[field] = value;
}

function saveQRowDiff(sectionId, rowId, diff, field, value) {
  const row = (questionRows[sectionId]||[]).find(r => r.id === rowId);
  if (row && row.diffs[diff]) row.diffs[diff][field] = +value;
}

function handleQRowTagKey(event, sectionId, rowId) {
  const input = document.getElementById(`qt_${sectionId}_${rowId}`);
  if (!input) return;
  if (event.key === 'Enter' || event.key === ',') {
    event.preventDefault();
    const val = input.value.trim().replace(/,/g,'');
    if (val) {
      const row = (questionRows[sectionId]||[]).find(r => r.id === rowId);
      if (row && !row.tags.includes(val)) { row.tags.push(val); renderQRowTags(sectionId, rowId); }
      input.value = '';
    }
  } else if (event.key === 'Backspace' && input.value === '') {
    const row = (questionRows[sectionId]||[]).find(r => r.id === rowId);
    if (row && row.tags.length > 0) { row.tags.pop(); renderQRowTags(sectionId, rowId); }
  }
}

function removeQRowTag(sectionId, rowId, tag) {
  const row = (questionRows[sectionId]||[]).find(r => r.id === rowId);
  if (row) { row.tags = row.tags.filter(t => t !== tag); renderQRowTags(sectionId, rowId); }
}

function renderQRowTags(sectionId, rowId) {
  const wrap = document.getElementById(`tagwrap_${sectionId}_${rowId}`);
  if (!wrap) return;
  const row = (questionRows[sectionId]||[]).find(r => r.id === rowId);
  if (!row) return;
  wrap.innerHTML = row.tags.map(t =>
    `<span class="qrow-tag-chip">${t}<span class="qrow-chip-remove" onclick="removeQRowTag(${sectionId},${rowId},'${t}')">âœ•</span></span>`
  ).join('') + `<input type="text" class="qrow-tag-input" id="qt_${sectionId}_${rowId}"
      placeholder="${row.tags.length===0?'Type + Enterâ€¦':''}"
      onkeydown="handleQRowTagKey(event,${sectionId},${rowId})" autocomplete="off">`;
}

function renderQRows(sectionId) {
  const tbody = document.getElementById('qrows_' + sectionId);
  if (!tbody) return;
  const rows = questionRows[sectionId] || [];

  tbody.innerHTML = rows.map((r, gi) => {
    const groupBg = gi % 2 === 0 ? '#ffffff' : '#fafaf8';
    // shared cells span 3 rows
    // Only render diffs that still exist on this row
    const activeDiffs = DIFFS.filter(d => r.diffs[d]);
    const span = activeDiffs.length;

    const sharedCells = `
      <td rowspan="${span}" style="background:${groupBg};vertical-align:middle;">
        <select onchange="saveQRowField(${sectionId},${r.id},'lib',this.value)" style="background:${groupBg};">
          <option value="" ${!r.lib?'selected':''}>â€” Select â€”</option>
          <option value="Topin Questions" ${r.lib==='Topin Questions'?'selected':''}>Topin Questions</option>
          <option value="My Questions" ${r.lib==='My Questions'?'selected':''}>My Questions</option>
        </select>
      </td>
      <td rowspan="${span}" style="background:${groupBg};vertical-align:middle;">
        <input type="text" placeholder="e.g. Algebra" value="${r.topic}"
          onchange="saveQRowField(${sectionId},${r.id},'topic',this.value)" style="background:${groupBg};">
      </td>
      <td rowspan="${span}" style="background:${groupBg};vertical-align:middle;">
        <input type="text" placeholder="e.g. Linear Eq." value="${r.subtopic}"
          onchange="saveQRowField(${sectionId},${r.id},'subtopic',this.value)" style="background:${groupBg};">
      </td>`;

    const sharedTagCell = `
      <td rowspan="${span}" class="qrow-tag-cell" style="background:${groupBg};vertical-align:middle;">
        <div class="qrow-tag-wrap" id="tagwrap_${sectionId}_${r.id}"
          onclick="document.getElementById('qt_${sectionId}_${r.id}').focus()">
          ${r.tags.map(t => `<span class="qrow-tag-chip">${t}<span class="qrow-chip-remove" onclick="removeQRowTag(${sectionId},${r.id},'${t}')">âœ•</span></span>`).join('')}
          <input type="text" class="qrow-tag-input" id="qt_${sectionId}_${r.id}"
            placeholder="${r.tags.length===0?'Type + Enterâ€¦':''}"
            onkeydown="handleQRowTagKey(event,${sectionId},${r.id})" autocomplete="off">
        </div>
      </td>`;

    const deleteCell = `
      <td rowspan="${span}" class="qrow-delete-cell" style="background:${groupBg};vertical-align:middle;">
        <button class="qrow-delete-btn" title="Remove group" onclick="deleteQRow(${sectionId},${r.id})">âœ•</button>
      </td>`;

    return activeDiffs.map((diff, di) => {
      const ds = DIFF_STYLE[diff];
      const diffCell = `<td style="background:${ds.bg};border-left:3px solid ${ds.border};padding:0;">
        <span style="display:block;font-family:var(--mono);font-size:10px;font-weight:700;
          color:${ds.color};padding:9px 10px;letter-spacing:0.04em;">${diff}</span>
      </td>`;
      const numqCell = `<td style="background:${ds.bg};width:80px;">
        <input type="number" min="0" value="${r.diffs[diff].numq}" style="background:${ds.bg};"
          onchange="saveQRowDiff(${sectionId},${r.id},'${diff}','numq',this.value)">
      </td>`;
      const marksCell = `<td style="background:${ds.bg};width:80px;">
        <input type="number" min="0" step="0.5" value="${r.diffs[diff].marks}" style="background:${ds.bg};"
          onchange="saveQRowDiff(${sectionId},${r.id},'${diff}','marks',this.value)">
      </td>`;

      if (di === 0) {
        return `<tr class="qrow-group-start">${sharedCells}${diffCell}${sharedTagCell}${numqCell}${marksCell}${deleteCell}</tr>`;
      } else {
        return `<tr>${diffCell}${numqCell}${marksCell}</tr>`;
      }
    }).join('');
  }).join('');
}

function restoreQRows() {
  sections.forEach(s => {
    if (!questionRows[s.id]) questionRows[s.id] = [newQRow()];
    renderQRows(s.id);
  });
}


function updateSectionName(id, val) {
  const sec = sections.find(s => s.id === id);
  if (sec) {
    const defaults = {
      Coding: 'Coding Section', MCQ: 'Technical MCQs',
      SQL: 'SQL Coding', WebCoding: 'Web Coding', IDECoding: 'IDE Coding'
    };
    sec.name = val || defaults[sec.type] || 'Section';
    const tab = document.querySelector(`.section-tab[data-id="${id}"] span:first-child`);
    if (tab) tab.textContent = sec.name;
  }
}

// â”€â”€â”€ LANGUAGE MANAGEMENT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setDefaultLang(sectionId, lang) {
  const sec = sections.find(s => s.id === sectionId);
  if (!sec) return;
  sec.langs = [lang, ...sec.langs.filter(l => l !== lang)];
  renderPanels();
  setActiveTab(sectionId);
}

function addLang(sectionId) {
  const sec = sections.find(s => s.id === sectionId);
  const sel = document.getElementById('langAdd_' + sectionId);
  if (!sel || !sel.value) return;
  const lang = sel.value;
  if (!sec.langs.includes(lang)) {
    sec.langs.push(lang);
    renderPanels();
    setActiveTab(sectionId);
  }
}

function removeLang(sectionId, lang) {
  const sec = sections.find(s => s.id === sectionId);
  if (sec.langs.length <= 1) return;
  sec.langs = sec.langs.filter(l => l !== lang);
  renderPanels();
  setActiveTab(sectionId);
}

// â”€â”€â”€ SAVE CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function saveConfiguration() {
  const data = collectData();
  if (!data.general.name) { alert('Please enter an Assessment Name before saving.'); return; }
  let pruned = 0;
  sections.forEach(s => {
    const rows = questionRows[s.id] || [];
    rows.forEach(r => {
      DIFFS.forEach(diff => {
        if (r.diffs[diff] !== undefined && !(r.diffs[diff].numq > 0)) {
          delete r.diffs[diff]; pruned++;
        }
      });
    });
    questionRows[s.id] = rows.filter(r => Object.keys(r.diffs).length > 0);
    if (questionRows[s.id].length === 0) questionRows[s.id] = [newQRow()];
    renderQRows(s.id);
  });
  alert(pruned > 0 ? `Saved. ${pruned} zero-entry difficulty row${pruned>1?'s':''} removed.` : 'Configuration saved.');
}

// â”€â”€â”€ COLLECT FORM DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function collectData() {
  const getLabel = (text) => {
    for (const l of document.querySelectorAll('.field label')) {
      if (l.textContent.trim() === text) {
        const inp = l.parentElement.querySelector('input,select');
        return inp ? inp.value.trim() : '';
      }
    }
    return '';
  };
  const general = {
    name:      getLabel('Name of Assessment'),
    org:       getLabel('Organization Name'),
    logo:      getLabel('Organization Logo URL'),
    startDate: document.querySelectorAll('input[type=datetime-local]')[0]?.value || '',
    endDate:   document.querySelectorAll('input[type=datetime-local]')[1]?.value || '',
  };
  const advanced = {
    tabSwitch:  document.querySelector('input[name=tab_switch]:checked')?.nextElementSibling?.textContent?.trim() || 'No',
    proctoring: document.querySelector('input[name=proctoring]:checked')?.nextElementSibling?.textContent?.trim() || 'On',
  };
  const sectionData = sections.map(s => {
    const timeEl = document.getElementById(`s${s.id}_time`);
    const rows = (questionRows[s.id] || []).map(r => ({
      lib: r.lib, topic: r.topic, subtopic: r.subtopic, tags: r.tags,
      diffs: Object.entries(r.diffs).map(([diff, v]) => ({ diff, numq: v.numq, marks: v.marks }))
    }));
    return { name: s.name, type: s.type, time: timeEl?.value || '', rows, langs: s.langs || [] };
  });
  return { general, advanced, sections: sectionData };
}

// â”€â”€â”€ GENERATE OUTPUT HTML â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function generateOutputHTML(data) {
  const TYPE_COLORS = {
    Coding:'#087f5b', MCQ:'#3b5bdb', SQL:'#c2255c', WebCoding:'#1864ab', IDECoding:'#6741d9'
  };
  const DIFF_COLORS = {
    Easy:  {bg:'#edf7f1',color:'#1a6b3a'},
    Medium:{bg:'#fdf7ed',color:'#8a5c00'},
    Hard:  {bg:'#fdf0f0',color:'#9b1515'}
  };
  const fmt = v => v || 'â€”';

  const sectionsHTML = data.sections.map((s, i) => {
    const hc = TYPE_COLORS[s.type] || '#2c2c2c';
    const rowsHTML = s.rows.map(r => {
      return r.diffs.map((d, di) => {
        const dc = DIFF_COLORS[d.diff] || {bg:'#f5f3ee', color:'#333'};
        const shared = di === 0 ? `
          <td rowspan="${r.diffs.length}" style="padding:8px 12px;border:1px solid #e0ddd8;vertical-align:middle;font-size:13px;">${fmt(r.lib)}</td>
          <td rowspan="${r.diffs.length}" style="padding:8px 12px;border:1px solid #e0ddd8;vertical-align:middle;font-size:13px;">${fmt(r.topic)}</td>
          <td rowspan="${r.diffs.length}" style="padding:8px 12px;border:1px solid #e0ddd8;vertical-align:middle;font-size:13px;">${fmt(r.subtopic)}</td>` : '';
        const tagsCell = di === 0 ? `<td rowspan="${r.diffs.length}" style="padding:8px 12px;border:1px solid #e0ddd8;vertical-align:middle;">${
          r.tags && r.tags.length ? r.tags.map(t=>`<span style="background:#edf7f1;border:1px solid #1a6b3a;color:#1a472a;font-size:10px;padding:2px 7px;border-radius:2px;font-weight:600;">${t}</span>`).join(' ') : 'â€”'
        }</td>` : '';
        return `<tr>
          ${shared}
          <td style="padding:8px 12px;border:1px solid #e0ddd8;background:${dc.bg};color:${dc.color};font-weight:700;font-size:11px;letter-spacing:.04em;border-left:3px solid ${dc.color};">${d.diff}</td>
          ${tagsCell}
          <td style="padding:8px 12px;border:1px solid #e0ddd8;text-align:center;font-size:13px;">${d.numq}</td>
          <td style="padding:8px 12px;border:1px solid #e0ddd8;text-align:center;font-size:13px;">${d.marks}</td>
        </tr>`;
      }).join('');
    }).join('');

    const langsHTML = s.langs && s.langs.length ? `
      <div style="padding:12px 20px;border-top:1px solid #e0ddd8;background:#fafaf8;">
        <span style="font-family:monospace;font-size:9px;font-weight:600;letter-spacing:.1em;color:#6b6560;text-transform:uppercase;">Languages</span>
        <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;">
          ${s.langs.map((l,i)=>`<span style="background:${i===0?'#1a472a':'#edf7f1'};color:${i===0?'#fff':'#1a472a'};border:1.5px solid #1a472a;padding:3px 10px;font-family:monospace;font-size:11px;font-weight:600;border-radius:2px;">${i===0?'DEFAULT Â· ':''} ${l}</span>`).join('')}
        </div>
      </div>` : '';

    return `
    <div style="border:2px solid #2c2c2c;margin-bottom:24px;">
      <div style="background:${hc};color:#fff;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;">
        <span style="font-family:monospace;font-size:13px;font-weight:600;letter-spacing:.06em;text-transform:uppercase;">Section ${i+1}: ${s.name}</span>
        <span style="background:rgba(255,255,255,.15);color:#fff;font-family:monospace;font-size:9px;font-weight:700;padding:2px 10px;">${s.type}</span>
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;border-bottom:1px solid #e0ddd8;">
        <div style="padding:10px 16px;border-right:1px solid #e0ddd8;">
          <div style="font-family:monospace;font-size:9px;font-weight:600;letter-spacing:.1em;color:#6b6560;text-transform:uppercase;margin-bottom:4px;">Time Limit</div>
          <div style="font-size:14px;">${fmt(s.time)} mins</div>
        </div>
        <div style="padding:10px 16px;">
          <div style="font-family:monospace;font-size:9px;font-weight:600;letter-spacing:.1em;color:#6b6560;text-transform:uppercase;margin-bottom:4px;">Type</div>
          <div style="font-size:14px;">${s.type}</div>
        </div>
      </div>
      <div style="background:#2c2c2c;color:#f5f3ee;padding:7px 16px;font-family:monospace;font-size:9px;font-weight:600;letter-spacing:.12em;text-transform:uppercase;">Question Combinations</div>
      <div style="overflow-x:auto;">
        <table style="width:100%;border-collapse:collapse;font-family:sans-serif;">
          <thead>
            <tr style="background:#f0ede7;">
              <th style="padding:8px 12px;border:1px solid #e0ddd8;text-align:left;font-family:monospace;font-size:9px;letter-spacing:.08em;text-transform:uppercase;color:#6b6560;">Library</th>
              <th style="padding:8px 12px;border:1px solid #e0ddd8;text-align:left;font-family:monospace;font-size:9px;letter-spacing:.08em;text-transform:uppercase;color:#6b6560;">Topic</th>
              <th style="padding:8px 12px;border:1px solid #e0ddd8;text-align:left;font-family:monospace;font-size:9px;letter-spacing:.08em;text-transform:uppercase;color:#6b6560;">Sub Topic</th>
              <th style="padding:8px 12px;border:1px solid #e0ddd8;text-align:left;font-family:monospace;font-size:9px;letter-spacing:.08em;text-transform:uppercase;color:#6b6560;">Difficulty</th>
              <th style="padding:8px 12px;border:1px solid #e0ddd8;text-align:left;font-family:monospace;font-size:9px;letter-spacing:.08em;text-transform:uppercase;color:#6b6560;">Tags</th>
              <th style="padding:8px 12px;border:1px solid #e0ddd8;text-align:center;font-family:monospace;font-size:9px;letter-spacing:.08em;text-transform:uppercase;color:#6b6560;">Questions</th>
              <th style="padding:8px 12px;border:1px solid #e0ddd8;text-align:center;font-family:monospace;font-size:9px;letter-spacing:.08em;text-transform:uppercase;color:#6b6560;">Marks/Q</th>
            </tr>
          </thead>
          <tbody>${rowsHTML}</tbody>
        </table>
      </div>
      ${langsHTML}
    </div>`;
  }).join('');

  const now = new Date().toLocaleString('en-IN', {dateStyle:'medium', timeStyle:'short'});

  return `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>${data.general.name} â€” Topin Assessment Config</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  *{box-sizing:border-box;margin:0;padding:0;}
  body{font-family:'IBM Plex Sans',sans-serif;background:#f5f3ee;color:#1a1a1a;padding:40px 20px 80px;}
  .page{max-width:900px;margin:0 auto;}
</style>
</head>
<body>
<div class="page">
  <div style="border:2px solid #2c2c2c;background:#fff;padding:24px 32px;margin-bottom:28px;">
    <div style="font-family:'IBM Plex Mono',monospace;font-size:12px;color:#6b6560;margin-bottom:6px;">topin.tech</div>
    <h1 style="font-family:'IBM Plex Mono',monospace;font-size:26px;font-weight:600;letter-spacing:-.02em;">${fmt(data.general.name)}</h1>
    <div style="margin-top:10px;display:flex;gap:20px;flex-wrap:wrap;">
      <span style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:#6b6560;">Org: <strong style="color:#1a1a1a;">${fmt(data.general.org)}</strong></span>
      ${data.general.startDate ? `<span style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:#6b6560;">Start: <strong style="color:#1a1a1a;">${data.general.startDate.replace('T',' ')}</strong></span>` : ''}
      ${data.general.endDate ? `<span style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:#6b6560;">End: <strong style="color:#1a1a1a;">${data.general.endDate.replace('T',' ')}</strong></span>` : ''}
      <span style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:#6b6560;">Published: <strong style="color:#1a1a1a;">${now}</strong></span>
    </div>
  </div>
  <div style="border:2px solid #2c2c2c;background:#fff;margin-bottom:28px;">
    <div style="background:#2c2c2c;color:#f5f3ee;font-family:'IBM Plex Mono',monospace;font-size:10px;font-weight:600;letter-spacing:.14em;text-transform:uppercase;padding:10px 20px;">Advanced Options</div>
    <div style="display:grid;grid-template-columns:1fr 1fr;">
      <div style="padding:12px 20px;border-right:1px solid #e0ddd8;">
        <div style="font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:600;letter-spacing:.1em;color:#6b6560;text-transform:uppercase;margin-bottom:4px;">Tab Switch Allowed</div>
        <div style="font-size:14px;font-weight:600;color:${data.advanced.tabSwitch==='Yes'?'#1a6b3a':'#9b1515'};">${data.advanced.tabSwitch}</div>
      </div>
      <div style="padding:12px 20px;">
        <div style="font-family:'IBM Plex Mono',monospace;font-size:9px;font-weight:600;letter-spacing:.1em;color:#6b6560;text-transform:uppercase;margin-bottom:4px;">Proctoring</div>
        <div style="font-size:14px;font-weight:600;color:${data.advanced.proctoring==='On'?'#1a6b3a':'#9b1515'};">${data.advanced.proctoring}</div>
      </div>
    </div>
  </div>
  ${sectionsHTML}
</div>
</body>
</html>`;
}

// â”€â”€â”€ DOWNLOAD CONFIGURATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function downloadConfiguration() {
  const data = collectData();
  if (!data.general.name) { alert('Please enter an Assessment Name before downloading.'); return; }
  const html = generateOutputHTML(data);
  const blob = new Blob([html], { type: 'text/html' });
  const url  = URL.createObjectURL(blob);
  const a    = document.createElement('a');
  a.href     = url;
  a.download = (data.general.name.replace(/[^a-z0-9]/gi, '-').toLowerCase() || 'assessment') + '.html';
  a.click();
  URL.revokeObjectURL(url);
}

// â”€â”€â”€ PUBLISH TO NETLIFY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function publishToNetlify() {
  const data = collectData();
  if (!data.general.name) {
    alert('Please enter an Assessment Name before publishing.');
    return;
  }
  const token = localStorage.getItem('netlify_token');
  if (!token) {
    document.getElementById('netlifyTokenModal').style.display = 'flex';
    return;
  }
  await doPublish(token, data);
}

async function doPublish(token, data) {
  const resultDiv = document.getElementById('publishResult');
  const statusEl  = document.getElementById('publishStatus');
  const urlEl     = document.getElementById('publishUrl');
  const copyBtn   = document.getElementById('copyUrlBtn');

  resultDiv.style.display = 'block';
  urlEl.style.display = 'none';
  copyBtn.style.display = 'none';
  statusEl.textContent = 'Generating HTML...';

  try {
    const html = generateOutputHTML(data);
    const slug = data.general.name.toLowerCase()
      .replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '').substring(0, 40) || 'assessment';

    statusEl.textContent = 'Packaging...';
    const zip = new JSZip();
    zip.file('index.html', html);
    const zipBlob = await zip.generateAsync({ type: 'blob' });

    statusEl.textContent = 'Creating Netlify site...';
    const siteName = slug + '-' + Date.now().toString(36);
    const siteRes = await fetch('https://api.netlify.com/api/v1/sites', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ name: siteName })
    });

    if (siteRes.status === 401) {
      localStorage.removeItem('netlify_token');
      statusEl.textContent = 'Invalid token â€” please re-enter.';
      setTimeout(() => { document.getElementById('netlifyTokenModal').style.display = 'flex'; }, 1200);
      return;
    }
    if (!siteRes.ok) throw new Error(`Site creation failed (${siteRes.status})`);
    const site = await siteRes.json();

    statusEl.textContent = 'Deploying...';
    const deployRes = await fetch(`https://api.netlify.com/api/v1/sites/${site.id}/deploys`, {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/zip'
      },
      body: zipBlob
    });
    if (!deployRes.ok) throw new Error(`Deploy failed (${deployRes.status})`);
    const deploy = await deployRes.json();

    statusEl.textContent = 'Processing...';
    const liveUrl = await pollDeployReady(token, deploy.id);

    statusEl.textContent = 'Published!';
    urlEl.href = liveUrl;
    urlEl.textContent = liveUrl;
    urlEl.style.display = 'inline';
    copyBtn.style.display = 'inline-block';

  } catch (err) {
    statusEl.textContent = 'Error: ' + err.message;
  }
}

async function pollDeployReady(token, deployId) {
  for (let i = 0; i < 30; i++) {
    await new Promise(r => setTimeout(r, 2000));
    const res = await fetch(`https://api.netlify.com/api/v1/deploys/${deployId}`, {
      headers: { 'Authorization': `Bearer ${token}` }
    });
    const d = await res.json();
    if (d.state === 'ready') return d.ssl_url || d.deploy_ssl_url;
    if (d.state === 'error') throw new Error('Deploy failed on Netlify');
  }
  throw new Error('Deploy timed out â€” check your Netlify dashboard');
}

function saveNetlifyToken() {
  const token = document.getElementById('netlifyTokenInput').value.trim();
  if (!token) return;
  localStorage.setItem('netlify_token', token);
  document.getElementById('netlifyTokenModal').style.display = 'none';
  const data = collectData();
  doPublish(token, data);
}

function copyPublishUrl() {
  const url = document.getElementById('publishUrl').href;
  navigator.clipboard.writeText(url).then(() => {
    const btn = document.getElementById('copyUrlBtn');
    btn.textContent = 'Copied!';
    setTimeout(() => { btn.textContent = 'Copy URL'; }, 2000);
  });
}

// â”€â”€â”€ CLEAR ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function clearAll() {
  if (!confirm('Clear all fields?')) return;
  document.querySelectorAll('input[type=text], input[type=url], input[type=number], input[type=datetime-local], textarea').forEach(el => {
    if (el.min === '2') el.value = '3'; // keep inactivity default
    else el.value = '';
  });
  document.querySelectorAll('select').forEach(el => el.selectedIndex = 0);
}

</script>
</body>
</html>
